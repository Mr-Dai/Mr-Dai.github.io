<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Gradle 学习笔记 - Robert Peng&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="呆呆的博客"><meta name="msapplication-TileImage" content="/img/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="呆呆的博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="本文为我个人的 Gradle 学习笔记，包含了 Gradle User Guide 各章节的重点归纳。归纳的内容从 User Guide 的第 4 章开始。"><meta property="og:type" content="blog"><meta property="og:title" content="Gradle 学习笔记"><meta property="og:url" content="https://mr-dai.github.io/gradle-note/"><meta property="og:site_name" content="Robert Peng&#039;s Blog"><meta property="og:description" content="本文为我个人的 Gradle 学习笔记，包含了 Gradle User Guide 各章节的重点归纳。归纳的内容从 User Guide 的第 4 章开始。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://mr-dai.github.io/img/og_image.png"><meta property="article:published_time" content="2018-04-23T16:00:00.000Z"><meta property="article:modified_time" content="2018-04-23T16:00:00.000Z"><meta property="article:author" content="Robert Peng"><meta property="article:tag" content="Gradle"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://mr-dai.github.io/gradle-note/"},"headline":"Gradle 学习笔记","image":["https://mr-dai.github.io/img/og_image.png"],"datePublished":"2018-04-23T16:00:00.000Z","dateModified":"2018-04-23T16:00:00.000Z","author":{"@type":"Person","name":"Robert Peng"},"publisher":{"@type":"Organization","name":"Robert Peng's Blog","logo":{"@type":"ImageObject","url":"https://mr-dai.github.io/img/avatar.png"}},"description":"本文为我个人的 Gradle 学习笔记，包含了 Gradle User Guide 各章节的重点归纳。归纳的内容从 User Guide 的第 4 章开始。"}</script><link rel="canonical" href="https://mr-dai.github.io/gradle-note/"><link rel="icon" href="/img/avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/avatar.png" alt="Robert Peng&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="我的 Github" href="https://github.com/Mr-Dai"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-04-23T16:00:00.000Z" title="4/23/2018, 4:00:00 PM">2018-04-24</time>发表</span><span class="level-item"><time dateTime="2018-04-23T16:00:00.000Z" title="4/23/2018, 4:00:00 PM">2018-04-24</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Gradle/">Gradle</a></span></div></div><h1 class="title is-3 is-size-4-mobile">Gradle 学习笔记</h1><div class="content"><p>本文为我个人的 Gradle 学习笔记，包含了 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/userguide.html">Gradle User Guide</a> 各章节的重点归纳。归纳的内容从 User Guide 的第 4 章开始。</p>
<span id="more"></span>

<p>本文的章节顺序有所调整以方便阅读。笔记会先从使用已有的 Gradle 项目开始，然后进入创建新的 Gradle 项目的部分。在创建项目的部分则会先以 Java 项目为例，再延伸到其他 JVM 语言项目。</p>
<h2 id="4-使用-Gradle-命令行"><a href="#4-使用-Gradle-命令行" class="headerlink" title="4 使用 Gradle 命令行"></a>4 使用 Gradle 命令行</h2><h3 id="4-1-执行多个任务"><a href="#4-1-执行多个任务" class="headerlink" title="4.1 执行多个任务"></a>4.1 执行多个任务</h3><p>在使用 Gradle 时，可以如命令 <kbd>gradle compile test</kbd> 这般指定执行多个 Gradle 任务，Gradle 会按照指定的顺序指定这些任务以及它们的以来任务。在执行时，Gradle 也会合理地绘制任务依赖 DAG，以确保被多个任务依赖的任务只执行一次。</p>
<p>（译者注：在 Gradle 安装目录的 <code>bin</code> 文件夹里实际上只有 <code>gradle</code> 一个可执行文件，因此所有的 Gradle 功能只能通过 <code>gradle</code> 命令或是后面提到的 <code>gradlew</code> 命令来执行）</p>
<p>除此之外，在代码示例 4.1 中看到我们可以使用 <code>&lt;&lt;</code> 运算符为某些默认任务追加逻辑：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">task compile &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">&#x27;compiling source&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task compileTest(<span class="attr">dependsOn:</span> compile) &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">&#x27;compiling unit tests&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task test(<span class="attr">dependsOn:</span> [compile, compileTest]) &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">&#x27;running unit tests&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task dist(<span class="attr">dependsOn:</span> [compile, test]) &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">&#x27;building the distribution&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-排除任务"><a href="#4-2-排除任务" class="headerlink" title="4.2 排除任务"></a>4.2 排除任务</h3><p>通过 <kbd>-x</kbd> 命令行选项可以在构建时排除指定的任务。被排除的任务不会被执行，同样其他依赖该任务的任务也不会被执行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; gradle dist -x test</span><br><span class="line">:compile</span><br><span class="line">compiling source</span><br><span class="line">:dist</span><br><span class="line">building the distribution</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line"></span><br><span class="line">Total time: 1 secs</span><br></pre></td></tr></table></figure>

<h3 id="4-3-在任务失败后继续构建"><a href="#4-3-在任务失败后继续构建" class="headerlink" title="4.3 在任务失败后继续构建"></a>4.3 在任务失败后继续构建</h3><p>在默认情况下，Gradle 会在某个任务执行失败后立刻停止执行。使用 <kbd>--continue</kbd> 选项可以使 Gradle 继续执行其它不相关的任务，但当一个任务执行失败后，其它依赖它的任务仍然不会被执行。</p>
<h3 id="4-4-任务名称缩写"><a href="#4-4-任务名称缩写" class="headerlink" title="4.4 任务名称缩写"></a>4.4 任务名称缩写</h3><p>在 Gradle 命令行中指定任务并不需要给出任务的全名，只要给出任务的前面几个字母足够给 Gradle 确定唯一的任务即可。如 <code>dist</code> 任务的执行可写作 <kbd>gradle d</kbd>。</p>
<p>对于使用驼峰命名法的任务我们还可以给出任务名每个单词的缩写，如 <code>compileTest</code> 任务可写作 <kbd>compTest</kbd> 甚至 <kbd>cT</kbd>。</p>
<p>任务名称缩写同样可用于前面提到的 <code>-x</code> 参数。</p>
<h3 id="4-5-选择要执行的构建"><a href="#4-5-选择要执行的构建" class="headerlink" title="4.5 选择要执行的构建"></a>4.5 选择要执行的构建</h3><p>执行 <kbd>gradle</kbd> 指令时，Gradle 会在当前路径下查找构建文件。我们还可以使用 <kbd>-b</kbd> 参数指定其他构建文件。但需要注意的是，使用了 <kbd>-b</kbd> 参数后 <code>settings.gradle</code> 文件便不会被使用。</p>
<p>除此之外，我们还可以通过 <kbd>-p</kbd> 来指定所使用的项目目录，对于多项目构建而言这是更好的做法。</p>
<h3 id="4-6-强制任务执行"><a href="#4-6-强制任务执行" class="headerlink" title="4.6 强制任务执行"></a>4.6 强制任务执行</h3><p>需要 Gradle 任务都支持增性构建：当它们检测到输入与输出和上一次执行相比没有发生变化时便会不执行，并在执行 <kbd>gradle</kbd> 命令时显示为 <code>UP-TO-DATE</code>。我们可以通过使用 <kbd>--rerun-tasks</kbd> 选项来强制执行所需的所有任务。</p>
<h3 id="4-7-获取构建的相关信息"><a href="#4-7-获取构建的相关信息" class="headerlink" title="4.7 获取构建的相关信息"></a>4.7 获取构建的相关信息</h3><h4 id="4-7-1-显示所有项目"><a href="#4-7-1-显示所有项目" class="headerlink" title="4.7.1 显示所有项目"></a>4.7.1 显示所有项目</h4><p>执行 <kbd>gradle projects</kbd> 即可显示所选项目的所有子项目，并显示各个项目的描述。项目的描述可在各个项目的 <code>build.gradle</code> 内通过修改项目的 <code>description</code> 属性进行设置：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">description = <span class="string">&#x27;The shared API for the application&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-7-2-显示所有任务"><a href="#4-7-2-显示所有任务" class="headerlink" title="4.7.2 显示所有任务"></a>4.7.2 显示所有任务</h4><p>执行 <kbd>gradle tasks</kbd> 即可显示所选项目的所有主要任务，包括项目的默认任务以及每个任务的描述。</p>
<p>默认情况下，该指令只会显示那些被赋予了分组的任务。任务的分组和描述可以分别通过修改其 <code>group</code> 和 <code>description</code> 属性进行设置：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dists &#123;</span><br><span class="line">    description = <span class="string">&#x27;Builds the distribution&#x27;</span></span><br><span class="line">    group = <span class="string">&#x27;build&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你也可以使用 <kbd>--all</kbd> 选项，如此便会显示所有分组和未分组的任务以及各个任务的依赖。</p>
<h4 id="4-7-3-查看任务的具体使用方法"><a href="#4-7-3-查看任务的具体使用方法" class="headerlink" title="4.7.3 查看任务的具体使用方法"></a>4.7.3 查看任务的具体使用方法</h4><p>通过执行 <kbd>gradle help --task someTask</kbd> 即可查看吻合给定任务名的所有任务的详细信息。这些信息包括其完整任务路径、任务类型、可用的命令行参数以及任务的描述。</p>
<h4 id="4-7-4-显示任务的依赖"><a href="#4-7-4-显示任务的依赖" class="headerlink" title="4.7.4 显示任务的依赖"></a>4.7.4 显示任务的依赖</h4><p>使用 <kbd>gradle dependencies</kbd> 可以查看每个任务的依赖，其直接与间接的依赖将以树状的形式显示。</p>
<p>由于所有任务的所有依赖加起来可能会包含大量的输出信息，因此可以使用 <kbd>--configuration</kbd> 参数查看指定配置的依赖。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; gradle -q api:dependencies --configuration testCompile</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">Project :api - The shared API for the application</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">testCompile</span><br><span class="line">\--- junit:junit:4.12</span><br><span class="line">     \--- org.hamcrest:hamcrest-core:1.3</span><br></pre></td></tr></table></figure>

<p>在执行 <code>gradle</code> 命令时使用 <kbd>-q</kbd> 命令行参数可以去除 Gradle 的日志信息，只保留任务本身的输出。有关 Gradle 日志的更多信息详见 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/logging.html">22 章</a>。</p>
<h4 id="4-7-5-显示项目的构建脚本依赖"><a href="#4-7-5-显示项目的构建脚本依赖" class="headerlink" title="4.7.5 显示项目的构建脚本依赖"></a>4.7.5 显示项目的构建脚本依赖</h4><p>运行指令 <kbd>gradle buildEnvironment</kbd> 可以显示项目的构建脚本依赖，显示的格式与 <kbd>gradle dependencies</kbd> 类似。</p>
<h4 id="4-7-6-查看具体依赖的详细信息"><a href="#4-7-6-查看具体依赖的详细信息" class="headerlink" title="4.7.6 查看具体依赖的详细信息"></a>4.7.6 查看具体依赖的详细信息</h4><p>运行指令 <kbd>gradle dependencyInsight</kbd> 即可查看具体依赖的指定信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; gradle -q webapp:dependencyInsight --dependency groovy --configuration compile</span><br><span class="line">org.codehaus.groovy:groovy-all:2.4.7</span><br><span class="line">\--- project :api</span><br><span class="line">     \--- compile</span><br></pre></td></tr></table></figure>

<p>该指令可用于查看某个具体的依赖包是从如何被解析出来的。在使用该指令时，我们需要像上述示例那样通过 <kbd>--dependency</kbd> 和 <kbd>--configuration</kbd> 参数指定要查看的依赖和配置。</p>
<h4 id="4-7-7-显示所有项目属性"><a href="#4-7-7-显示所有项目属性" class="headerlink" title="4.7.7 显示所有项目属性"></a>4.7.7 显示所有项目属性</h4><p>执行 <kbd>gradle properties</kbd> 可以查看项目的所有属性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; gradle -q api:properties</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">Project :api - The shared API for the application</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">allprojects: [project &#x27;:api&#x27;]</span><br><span class="line">ant: org.gradle.api.internal.project.DefaultAntBuilder@12345</span><br><span class="line">antBuilderFactory: org.gradle.api.internal.project.DefaultAntBuilderFactory@12345</span><br><span class="line">artifacts: org.gradle.api.internal.artifacts.dsl.DefaultArtifactHandler_Decorated@12345</span><br><span class="line">asDynamicObject: DynamicObject for project &#x27;:api&#x27;</span><br><span class="line">baseClassLoaderScope: org.gradle.api.internal.initialization.DefaultClassLoaderScope@12345</span><br><span class="line">buildDir: /home/user/gradle/samples/userguide/tutorial/projectReports/api/build</span><br><span class="line">buildFile: /home/user/gradle/samples/userguide/tutorial/projectReports/api/build.gradle</span><br></pre></td></tr></table></figure>

<h4 id="4-7-8-构建报告"><a href="#4-7-8-构建报告" class="headerlink" title="4.7.8 构建报告"></a>4.7.8 构建报告</h4><p>在执行构建时使用 <kbd>--profile</kbd> 选项即可在构建后于 <code>build/reports/profile</code> 处生成构建报告。报告的内容包括从配置到任务执行等各个阶段所花的时间。</p>
<h3 id="4-8-构建预演"><a href="#4-8-构建预演" class="headerlink" title="4.8 构建预演"></a>4.8 构建预演</h3><p>在构建时使用 <kbd>-m</kbd> 选项可进入构建预演模式，会显示此次构建会以何种顺序执行哪些任务，但不会执行这些任务。</p>
<h3 id="4-9-总结"><a href="#4-9-总结" class="headerlink" title="4.9 总结"></a>4.9 总结</h3><p>有关 Gradle 命令行的详细介绍可参阅<a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/gradle_command_line.html">附录 D：Gradle 命令行</a>。</p>
<h2 id="5-Gradle-Wrapper"><a href="#5-Gradle-Wrapper" class="headerlink" title="5 Gradle Wrapper"></a>5 Gradle Wrapper</h2><p>在分发项目源代码时，源代码中可以放入特定版本的 Gradle Wrapper。此举的好处有两点：</p>
<ul>
<li>避免代码用户因所使用的 Gradle 版本不同导致构建出错</li>
<li>使我们无需对所使用的持续构建服务器做过多的配置</li>
</ul>
<h3 id="5-1-使用-Gradle-Wrapper-执行构建"><a href="#5-1-使用-Gradle-Wrapper-执行构建" class="headerlink" title="5.1 使用 Gradle Wrapper 执行构建"></a>5.1 使用 Gradle Wrapper 执行构建</h3><p>对于安装了 Gradle Wrapper 的项目，我们应使用 <kbd>gradlew <task></kbd> 对其执行构建，其中命令 <code>gradlew</code> 的使用方法和 <code>gradle</code> 完全一致。</p>
<p>Gradle Wrapper 的所有文件包括如下，注意不要让版本控制系统忽略这些文件：</p>
<ul>
<li><code>gradlew</code>（Unix Shell 脚本）</li>
<li><code>gradlew.bat</code>（Windows 批处理文件）</li>
<li><code>gradle/wrapper/gradle-wrapper.jar</code>（Wrapper 的 JAR）</li>
<li><code>gradle/wrapper/gradle-wrapper.properties</code>（Wrapper 的 properties 文件）</li>
</ul>
<p>（译者注：可考虑让版本控制系统忽略 <code>.gradle</code> 文件夹）</p>
<p>在执行的过程中，<code>gradlew</code> 会把指定版本的 Gradle 下载至 <code>$USER_HOME/.gradle/wrapper/dists</code> 并执行。</p>
<h3 id="5-2-为项目安装-Wrapper"><a href="#5-2-为项目安装-Wrapper" class="headerlink" title="5.2 为项目安装 Wrapper"></a>5.2 为项目安装 Wrapper</h3><p>执行 <kbd>gradle wrapper</kbd> 即可为项目安装 Gradle Wrapper。在执行该指令时，我们可以通过参数 <kbd>--gradle-version</kbd> 和 <kbd>--gradle-distribution-url</kbd> 配置需要安装的 Wrapper 的版本和下载 Gradle 的路径。默认安装的 Wrapper 版本与安装时所使用的 Gradle 版本相同。</p>
<p>除此之外，我们还可以在构建脚本中配置一个 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/dsl/org.gradle.api.tasks.wrapper.Wrapper.html"><code>Wrapper</code></a> 任务，如通过设置属性 <code>gradleVersion</code> 来改变默认的 Wrapper 版本：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">task wrapper(<span class="attr">type:</span> Wrapper) &#123;</span><br><span class="line">    gradleVersion = <span class="string">&#x27;2.0&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有关 <code>Wrapper</code> 任务的更多配置方式，请查阅 <code>Wrapper</code> 的 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/dsl/org.gradle.api.tasks.wrapper.Wrapper.html">API 文档</a>。</p>
<h2 id="6-Gradle-守护线程"><a href="#6-Gradle-守护线程" class="headerlink" title="6 Gradle 守护线程"></a>6 Gradle 守护线程</h2><h3 id="6-1-为何要使用-Gradle-守护线程"><a href="#6-1-为何要使用-Gradle-守护线程" class="headerlink" title="6.1 为何要使用 Gradle 守护线程"></a>6.1 为何要使用 Gradle 守护线程</h3><p>启动 Gradle 进行项目构建的过程首先涉及到 JVM 的启动，同时 Gradle 依赖的一些库也需要比较长的时间进行初始化，这就使得启动 Gradle 进行构建首先需要等待其进行初始化。</p>
<p>解决的办法就是使用一个持续在后台运行的 Gradle 守护线程，每一次都将构建任务提交至该守护线程便可跳过这些初始化。除此之外，守护线程还会对项目的如依赖 DAG 等信息进行缓存，更进一步地缩小构建所需的时间。</p>
<p>在使用 <code>--profile</code> 选项生成构建报告时可以在报告中看到守护线程可以为构建节省多少时间。</p>
<p>从 3.0 版本开始，Gradle 守护线程将会默认开启。（译者注：实际上是如果 <code>gradle</code> 命令发现守护线程不存在便会自动开启守护线程）</p>
<h3 id="6-2-检查守护线程的状态"><a href="#6-2-检查守护线程的状态" class="headerlink" title="6.2 检查守护线程的状态"></a>6.2 检查守护线程的状态</h3><p>使用 <kbd>--status</kbd> 选项即可查看所有守护线程的状态。</p>
<h3 id="6-3-关闭守护线程功能"><a href="#6-3-关闭守护线程功能" class="headerlink" title="6.3 关闭守护线程功能"></a>6.3 关闭守护线程功能</h3><p>永久关闭守护线程功能的方式有两种：</p>
<ul>
<li>将标识 <code>-Dorg.gradle.daemon=false</code> 添加至 <code>GRADLE_OPTS</code> 环境变量</li>
<li>将代码 <code>org.gradle.daemon=false</code> 添加至属性文件 <code>$GRADLE_USER_HOME/gradle.properties</code></li>
</ul>
<p>其中，<code>GRADLE_USER_HOME</code> 变量的默认值为 <code>$USER_HOME/.gradle</code>。该值可以通过 <kbd>-g</kbd> 或 <kbd>--gradle-user-home</kbd> 命令行参数进行设置，或是直接修改 <code>GRADLE_USER_HOME</code> 环境变量或 <code>org.gradle.user.home</code> JVM 系统属性。</p>
<p>在 Windows 中执行如下指令可为当前用户关闭守护线程功能：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(if not exist &quot;%USERPROFILE%/.gradle&quot; mkdir &quot;%USERPROFILE%/.gradle&quot;) &amp;&amp; (echo org.gradle.daemon=false &gt;&gt; &quot;%USERPROFILE%/.gradle/gradle.properties&quot;)</span><br></pre></td></tr></table></figure>

<p>类 Unix 系统则可通过如下 Bash 指令为当前用户关闭守护线程功能：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/.gradle &amp;&amp; echo &quot;org.gradle.daemon=false&quot; &gt;&gt; ~/.gradle/gradle.properties</span><br></pre></td></tr></table></figure>

<p>在构建时，我们还可以通过 <kbd>--daemon</kbd> 和 <kbd>--no-daemon</kbd> 选项来显式地声明此次构建是否要使用守护线程。</p>
<h3 id="6-4-关闭正在运行的守护线程"><a href="#6-4-关闭正在运行的守护线程" class="headerlink" title="6.4 关闭正在运行的守护线程"></a>6.4 关闭正在运行的守护线程</h3><p>每个 Gradle 守护线程在闲置时都会不断对比自己占用的内存和系统剩余的内存，并在剩余内存不多时关闭自己以释放内存。因此在大多数时候我们不需要手动关闭守护线程。</p>
<p>不过，我们也可以通过指令 <kbd>gradle --stop</kbd> 关闭所有 Gradle 守护线程。</p>
<h3 id="6-6-何时不该使用-Gradle-守护线程"><a href="#6-6-何时不该使用-Gradle-守护线程" class="headerlink" title="6.6 何时不该使用 Gradle 守护线程"></a>6.6 何时不该使用 Gradle 守护线程</h3><p>我们应在开发环境里使用 Gradle 守护线程来加速构建，但在持续整合服务器上，稳定性才是至关重要的，这时我们就应关闭 Gradle 守护线程功能，确保不同的构建之间是完全相互独立的。</p>
<h2 id="7-依赖管理入门"><a href="#7-依赖管理入门" class="headerlink" title="7 依赖管理入门"></a>7 依赖管理入门</h2><p>本章内容只是对 Gradle 的依赖管理系统进行了浅显的介绍，在用户手册靠后的章节中会对依赖管理系统的不同部分进行详细的阐述，本章中也会给出具体的链接。</p>
<h3 id="7-2-声明依赖"><a href="#7-2-声明依赖" class="headerlink" title="7.2 声明依赖"></a>7.2 声明依赖</h3><p>先看一个示例 <code>build.gradle</code>：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;java&#x27;</span></span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="attr">group:</span> <span class="string">&#x27;org.hibernate&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;hibernate-core&#x27;</span>, <span class="attr">version:</span> <span class="string">&#x27;3.6.7.Final&#x27;</span></span><br><span class="line">    testCompile <span class="attr">group:</span> <span class="string">&#x27;junit&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;junit&#x27;</span>, <span class="attr">version:</span> <span class="string">&#x27;4.+&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个示例实际上就包含了声明依赖的几个基本元素。</p>
<h3 id="7-3-依赖配置"><a href="#7-3-依赖配置" class="headerlink" title="7.3 依赖配置"></a>7.3 依赖配置</h3><p>Gradle 会根据依赖所赋予的配置（Configuration）对其进行分组。对于 Java 项目所使用的 Java 插件来说，插件本身定义了的依赖配置即为 Java 程序编译到运行的几个生命周期。常用的包括：</p>
<ul>
<li><code>compile</code>：编译项目源文件所需的依赖</li>
<li><code>runtime</code>：运行项目所需的依赖。默认包含上述的编译时依赖</li>
<li><code>testCompile</code>：编译项目测试源文件所需的依赖。默认包含上述的编译时依赖和项目源文件编译后产生的类文件</li>
<li><code>testRuntime</code>：运行项目测试所需的依赖。默认包含上述的编译依赖、运行依赖和测试编译依赖</li>
</ul>
<p>有关 Java 插件定义的依赖配置的更多内容详见<a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/java_plugin.html#tab:configurations">表 45.5</a>。</p>
<p>有关依赖配置的更多内容详见 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/dependency_management.html#sub:configurations">23.3 小节</a>。</p>
<h3 id="7-4-外部依赖"><a href="#7-4-外部依赖" class="headerlink" title="7.4 外部依赖"></a>7.4 外部依赖</h3><p>我们可以通过属性 <code>group</code>、<code>name</code> 和 <code>version</code> 为 Gradle 唯一地指定外部依赖：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="attr">group:</span> <span class="string">&#x27;org.hibernate&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;hibernate-core&#x27;</span>, <span class="attr">version:</span> <span class="string">&#x27;3.6.7.Final&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者我们也可以将其简写为 <code>group:name:version</code> 的形式：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">&#x27;org.hibernate:hibernate-core:3.6.7.Final&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有关声明依赖的更多内容详见 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/dependency_management.html#sec:how_to_declare_your_dependencies">23.4 小节</a>。</p>
<h3 id="7-5-库"><a href="#7-5-库" class="headerlink" title="7.5 库"></a>7.5 库</h3><p>Gradle 需要在 <code>build.gradle</code> 脚本中为 <code>Project.repositories</code> 属性进行设置，指定用于下载依赖的远程库。<br>常用的设置方式包括如下几种：</p>
<table class="table">
    <tr>
        <th>库类型</th>
        <th>构建脚本</th>
    </tr>
    <tr>
        <td>Maven 中心库</td>
        <td>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </td>
    </tr>
    <tr>
        <td>JCenter 库</td>
        <td>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </td>
    </tr>
    <tr>
        <td>自定义的远程 Maven 库</td>
        <td>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    maven &#123;</span><br><span class="line">        url <span class="string">&quot;http://repo.mycompany.com/maven2&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </td>
    </tr>
    <tr>
        <td>自定义的远程 Ivy 库</td>
        <td>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    ivy &#123;</span><br><span class="line">        url <span class="string">&quot;http://repo.mycompany.com/repo&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </td>
    </tr>
    <tr>
        <td>本地 Ivy 库</td>
        <td>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    ivy &#123;</span><br><span class="line">        <span class="comment">// URL can refer to a local directory</span></span><br><span class="line">        url <span class="string">&quot;../local-repo&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </td>
    </tr>
</table>

<p>有关库的更多内容详见 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/dependency_management.html#sec:repositories">23.6 小节</a>。</p>
<h3 id="7-6-发布程序包"><a href="#7-6-发布程序包" class="headerlink" title="7.6 发布程序包"></a>7.6 发布程序包</h3><p>Gradle 同样可以像 Maven 那样发布程序包。要做到这一点，我们需要将需要发布至的目标库定义到 <code>uploadArchives</code> 任务中：</p>
<table class="table">
    <tr>
        <th>目标库类型</th>
        <th>构建脚本</th>
    </tr>
    <tr>
        <td>Maven 库</td>
        <td>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;maven&#x27;</span></span><br><span class="line"></span><br><span class="line">uploadArchives &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenDeployer &#123;</span><br><span class="line">            repository(<span class="attr">url:</span> <span class="string">&quot;file://localhost/tmp/myRepo/&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>
        </td>
    </tr>
    <tr>
        <td>Ivy 库</td>
        <td>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">uploadArchives &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        ivy &#123;</span><br><span class="line">            credentials &#123;</span><br><span class="line">                username <span class="string">&quot;username&quot;</span></span><br><span class="line">                password <span class="string">&quot;pw&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            url <span class="string">&quot;http://repo.mycompany.com&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </td>
    </tr>
</table>

<p>而后执行 <code>uploadArchives</code> 任务，Gradle 便会构建项目并上传生成的程序包。</p>
<h2 id="8-多项目构建"><a href="#8-多项目构建" class="headerlink" title="8 多项目构建"></a>8 多项目构建</h2><h3 id="8-1-多项目构建的基本结构"><a href="#8-1-多项目构建的基本结构" class="headerlink" title="8.1 多项目构建的基本结构"></a>8.1 多项目构建的基本结构</h3><p>部分项目可能包含多个子项目或子模块，子项目相互之间存在一定的依赖关系。构建这样的项目则需要 Gradle 支持多项目构建。</p>
<p>通常，一个多项目构建包括如下几个基本元素：</p>
<ul>
<li>在项目根目录存在一个 <code>settings.gradle</code> 文件和一个 <code>build.gradle</code></li>
<li>每个子项目的根目录存在各自的 <code>*.gradle</code> 构建文件</li>
</ul>
<p>其中 <code>settings.gradle</code> 包含了项目所含子项目以及各个子项目所处位置的信息。除了直接阅读 <code>settings.gradle</code>，我们也可以通过执行 <kbd>gradle projects</kbd> 指令来查看项目下的所有子项目。</p>
<p>在默认情况下，Gradle 会将 <code>settings.gradle</code> 所处文件夹的名称作为根项目的名称，但部分持续构建服务器有可能会在构建时自动生成该文件夹名称，因此更好的做法是在 <code>settings.gradle</code> 中设置 <code>rootProject.name</code> 属性。</p>
<p>根目录的 <code>build.gradle</code> 用于进行各个子项目共享的设置，例如声明每个子项目都会使用的插件和依赖。</p>
<p>值得注意的是，子项目各自的 <code>*.gradle</code> 构建文件的名称有可能不是 <code>build.gradle</code>。另一种比较常见的做法是将其以子项目名称命名，如 <code>api.gradle</code> 或 <code>service.gradle</code>。</p>
<h3 id="8-2-执行多项目构建"><a href="#8-2-执行多项目构建" class="headerlink" title="8.2 执行多项目构建"></a>8.2 执行多项目构建</h3><p>对于一个项目源代码用户来说，构建包含多个子项目的项目实际上本质上也是通过 Gradle 执行不同的任务，不过控制具体执行哪个任务的方式则有所不同。我们有两种做法：</p>
<ul>
<li>进入你感兴趣的子项目所属的目录并像平常那样通过指令 <kbd>gradle < task></kdb> 执行你想要的任务</li>
<li>在任意目录下使用任务的限定名称来执行，如 <kbd>gradle :services:webservice:build</kbd></li>
</ul>
<p>对于第一种执行方式，Gradle 实际上会执行当前目录下所有子目录所包含的所有子项目的同名任务。比如执行命令 <kbd>gradle test</kbd> 则会执行所有相对于当前目录的子项目的 <code>test</code> 任务。</p>
<p>值得注意的是，使用这种执行方式时，调用 Gradle Wrapper 的方式需要进行一定的调整，因为 Gradle Wrapper 对应的 <code>gradlew</code> 执行文件是位于根目录下的，因此在执行时你可能需要输入像 <kbd>../../gradlew build</kbd> 这样的命令。</p>
<p>对于第二种方式，任务的限定名称结构和 Java 类的限定名类似，只是以冒号 <code>:</code> 作为分隔符，同时以一个起始的冒号指代根项目。</p>
<h2 id="9-持续构建"><a href="#9-持续构建" class="headerlink" title="9 持续构建"></a>9 持续构建</h2><p>在使用 Gradle 命令进行构建时，添加 <kbd>-t</kbd> 或 <kbd>--continuous</kbd> 选项即可打开持续构建模式：在该模式下，Gralde 会持续监控所指定任务的输入，并在输入发生变化时自动重新执行任务。例如在执行 <code>build</code> 任务时进入持续构建模式，Gradle 便会在源代码文件发生修改时自动重新构建项目。</p>
<p>值得注意的是，Gradle 只会监控所指定任务的输入，但如构建脚本等文件的修改不会导致 Gradle 自动重新执行任务。</p>
<p>任务可以通过一定的方式声明自己的输入和输出，详见<a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/more_about_tasks.html#incrementalTask">案例 17.24</a>。</p>
<h2 id="10-使用-Gradle-图形界面"><a href="#10-使用-Gradle-图形界面" class="headerlink" title="10 使用 Gradle 图形界面"></a>10 使用 Gradle 图形界面</h2><p>执行命令 <kbd>gradle --gui</kbd> 即可打开 Gradle 图形界面。注意该命令会一直阻塞直到图形界面退出，因此在 *nix 系统下你可以使用命令 <kbd>gradle --gui &</kbd> 来后台执行。</p>
<h2 id="15-构建初始化插件"><a href="#15-构建初始化插件" class="headerlink" title="15 构建初始化插件"></a>15 构建初始化插件</h2><p>我们可以使用 Gradle 自带的初始化插件在指定文件夹直接生成一个新的 Gradle 项目。</p>
<h3 id="15-1-所执行的任务"><a href="#15-1-所执行的任务" class="headerlink" title="15.1 所执行的任务"></a>15.1 所执行的任务</h3><p>该初始化插件为 Gradle 添加了如下任务：</p>
<ul>
<li><code>wrapper</code>：<a target="_blank" rel="noopener" href="https://docs.gradle.org/current/dsl/org.gradle.api.tasks.wrapper.Wrapper.html"><code>Wrapper</code></a> 类型的任务，在指定文件夹下生成 Gradle Wrapper</li>
<li><code>init</code>：<a target="_blank" rel="noopener" href="https://docs.gradle.org/current/dsl/org.gradle.buildinit.tasks.InitBuild.html"><code>InitBuild</code></a> 类型的任务，依赖 <code>wrapper</code> 任务，用于生成 Gradle 项目</li>
</ul>
<h3 id="15-2-初始化类型"><a href="#15-2-初始化类型" class="headerlink" title="15.2 初始化类型"></a>15.2 初始化类型</h3><p>在执行 <code>init</code> 任务时，我们需要使用 <code>--type</code> 命令行参数来给出初始化项目的类型。如果没有显式给出类型，Gradle 则会尝试自行推断类型。</p>
<p>支持的类型包括如下。</p>
<h4 id="15-3-1-pom"><a href="#15-3-1-pom" class="headerlink" title="15.3.1 pom"></a>15.3.1 <code>pom</code></h4><p><code>pom</code> 类型用于将一个已有的 Maven 项目转换为 Gradle 项目。该类型要求当前文件夹或 <code>-p</code> 命令行参数指定的文件夹下包含有效的 POM 文件以及 Maven 相关配置。如果在文件夹下能够找到有效的 POM 文件，Gradle 也会在未显式指定类型时推断出类型为 <code>pom</code>。</p>
<h4 id="15-3-2-java-library"><a href="#15-3-2-java-library" class="headerlink" title="15.3.2 java-library"></a>15.3.2 <code>java-library</code></h4><p><code>java-library</code> 只能通过显式指定，Gradle 不会自动推断为 <code>java-library</code> 类型。</p>
<p>该类型将自动为生成的项目使用 <code>java</code> 插件并使用 <code>jcenter</code> 依赖库，使用 <code>JUnit</code> 作为测试框架并生成基本的源代码和测试代码文件夹。</p>
<p>除此之外，在使用该类型时还可以通过 <code>--test-framework</code> 参数指定使用除 <a target="_blank" rel="noopener" href="http://junit.org/">JUnit</a> 以外的测试框架。支持的框架包括：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://code.google.com/p/spock/">Spock</a>：<kbd>gradle init --type java-library --test-framework spock</kbd></li>
<li><a target="_blank" rel="noopener" href="http://testng.org/doc/index.html">TestNG</a>：<kbd>gradle init --type java-library --test-framework testng</kbd></li>
</ul>
<h4 id="15-3-3-scala-library"><a href="#15-3-3-scala-library" class="headerlink" title="15.3.3 scala-library"></a>15.3.3 <code>scala-library</code></h4><p><code>scala-library</code> 只能通过显式指定，Gradle 不会自动推断为 <code>scala-library</code> 类型。</p>
<p>该类型将自动为生成的项目使用 <code>scala</code> 插件并使用 <code>jcenter</code> 依赖库，使用 <a target="_blank" rel="noopener" href="http://www.scalatest.org/">Scala Test</a>作为测试框架并生成基本的源代码和测试代码文件夹。除此之外，项目会自动使用 2.10 版本的 Scala 并默认使用 Zinc Scala 编译器。</p>
<h4 id="15-3-4-groovy-library"><a href="#15-3-4-groovy-library" class="headerlink" title="15.3.4 groovy-library"></a>15.3.4 <code>groovy-library</code></h4><p><code>groovy-library</code> 只能通过显式指定，Gradle 不会自动推断为 <code>groovy-library</code> 类型。</p>
<p>该类型将自动为生成的项目使用 <code>groovy</code> 插件并使用 <code>jcenter</code> 依赖库，使用 <a target="_blank" rel="noopener" href="http://spockframework.org/">Spock</a>作为测试框架并生成基本的源代码和测试代码文件夹。除此之外，项目会自动使用 2.x 版本的 Groovy。</p>
<h4 id="15-3-5-basic"><a href="#15-3-5-basic" class="headerlink" title="15.3.5 basic"></a>15.3.5 <code>basic</code></h4><p>默认的初始化类型，当类型没有被显式给出且无法自动推断为 <code>pom</code> 类型时便会使用该类型。此时 Gradle 会创建一个示例 <code>build.gradle</code> 文件并在其中放入有用的注释和链接。</p>
<h2 id="14-构建脚本入门"><a href="#14-构建脚本入门" class="headerlink" title="14 构建脚本入门"></a>14 构建脚本入门</h2><h3 id="14-1-项目和任务"><a href="#14-1-项目和任务" class="headerlink" title="14.1 项目和任务"></a>14.1 项目和任务</h3><p>在 Gradle 中主要包含两个基本概念：项目（Project）和任务（Task）。项目本身的定义并不明确，取决于你想要做些什么：一个项目可以构建什么东西，也可以部署别的什么东西。一个项目可以包含若干个任务，而一个任务则代表着一个构建可以执行的原子逻辑。</p>
<h3 id="14-2-Hello-World"><a href="#14-2-Hello-World" class="headerlink" title="14.2 Hello World"></a>14.2 Hello World</h3><p>这节主要给出了一个构建脚本的 Hello World 示例：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">task hello &#123;</span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">&#x27;Hello world!&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这段代码中调用了 <code>Task</code> 的 <code>doLast</code> 方法，其作用即把给定的 Groovy 闭包添加到任务的操作列表末尾。同样的还包括一个 <code>doFirst</code> 方法，顾名思义。</p>
<p>在声明了任务以后，我们就可以在脚本内像使用属性那样使用这个任务了：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">task hello &#123;</span><br><span class="line">    doLast &#123;</span><br><span class="line">        println <span class="string">&#x27;Hello Earth!&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">hello.doFirst &#123;</span><br><span class="line">    println <span class="string">&#x27;Hello Venus&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">hello.doLast &#123;</span><br><span class="line">    println <span class="string">&quot;Greetings from the $hello.name task.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">hello &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">&#x27;Hello Jupiter&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中方法 <code>&lt;&lt;</code> 实际上就是 <code>doLast</code> 的别名。</p>
<h3 id="14-4-构建脚本就是代码"><a href="#14-4-构建脚本就是代码" class="headerlink" title="14.4 构建脚本就是代码"></a>14.4 构建脚本就是代码</h3><p>实际上，Gradle 构建脚本所使用的语言正是 Groovy，因此在构建脚本中我们可以使用任意的 Groovy 代码：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">task upper &lt;&lt; &#123;</span><br><span class="line">    String someString = <span class="string">&#x27;mY_nAmE&#x27;</span></span><br><span class="line">    println <span class="string">&quot;Original: &quot;</span> + someString </span><br><span class="line">    println <span class="string">&quot;Upper case: &quot;</span> + someString.toUpperCase()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-5-任务依赖"><a href="#14-5-任务依赖" class="headerlink" title="14.5 任务依赖"></a>14.5 任务依赖</h3><p>在声明任务的同时我们也可以声明任务的依赖：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">task taskX(<span class="attr">dependsOn:</span> <span class="string">&#x27;taskY&#x27;</span>) &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">&#x27;taskX&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">task taskY &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">&#x27;taskY&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意声明依赖的任务的时候，被依赖的任务并不需要提前定义，正如上面的代码那样，尽管 <code>taskX</code> 依赖 <code>taskY</code>，<code>taskY</code> 也可以在 <code>taskX</code> 之后定义。</p>
<p>除此之外我们也可以在完成任务声明后再为任务赋予具体依赖：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">task taskX &lt;&lt; &#123;</span><br><span class="line">	println <span class="string">&#x27;taskX&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">task taskY &lt;&lt; &#123;</span><br><span class="line">	println <span class="string">&#x27;taskY&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">taskX.dependsOn taskY</span><br></pre></td></tr></table></figure>

<p>注意，以属性指定 <code>taskY</code> 时需要 <code>taskY</code> 以预先定义，否则可以用字符串的形式来给定 <code>taskY</code>：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">task taskX &lt;&lt; &#123;</span><br><span class="line">	println <span class="string">&#x27;taskX&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">taskX.dependsOn <span class="string">&#x27;taskY&#x27;</span></span><br><span class="line"></span><br><span class="line">task taskY &lt;&lt; &#123;</span><br><span class="line">	println <span class="string">&#x27;taskY&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-6-动态任务"><a href="#14-6-动态任务" class="headerlink" title="14.6 动态任务"></a>14.6 动态任务</h3><p>Gradle 脚本可以利用 Groovy 的动态特性来动态地创建任务：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4.</span>times &#123; counter -&gt;</span><br><span class="line">    task <span class="string">&quot;task$counter&quot;</span> &lt;&lt; &#123;</span><br><span class="line">        println <span class="string">&quot;I&#x27;m task number $counter&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">task0.dependsOn task2, task3</span><br></pre></td></tr></table></figure>

<h3 id="14-9-额外属性"><a href="#14-9-额外属性" class="headerlink" title="14.9 额外属性"></a>14.9 额外属性</h3><p>在任务定义内可以使用 <code>ext</code> 属性为任务定义额外属性：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">task myTask &#123;</span><br><span class="line">    ext.myProperty = <span class="string">&quot;myValue&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task printTaskProperties &lt;&lt; &#123;</span><br><span class="line">    println myTask.myProperty</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<p>有关额外属性的更多内容详见 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/writing_build_scripts.html#sec:extra_properties">16.4.2 节</a>。</p>
<h3 id="14-10-使用-Ant-任务"><a href="#14-10-使用-Ant-任务" class="headerlink" title="14.10 使用 Ant 任务"></a>14.10 使用 Ant 任务</h3><p>多亏了 Groovy 对 Ant 任务的支持，我们同样可以在 Gradle 中使用 Ant 任务来更方便地进行各式各样的文件读写操作：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">task loadfile &lt;&lt; &#123;</span><br><span class="line">    <span class="keyword">def</span> files = file(<span class="string">&#x27;../antLoadfileResources&#x27;</span>).listFiles().sort()</span><br><span class="line">    files.each &#123; File file -&gt;</span><br><span class="line">        <span class="keyword">if</span> (file.isFile()) &#123;</span><br><span class="line">            ant.loadfile(<span class="attr">srcFile:</span> file, <span class="attr">property:</span> file.name)</span><br><span class="line">            println <span class="string">&quot; *** $file.name ***&quot;</span></span><br><span class="line">            println <span class="string">&quot;$&#123;ant.properties[file.name]&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>详见 <a target="_blank" rel="noopener" href="http://docs.groovy-lang.org/latest/html/documentation/ant-builder.html">Groovy 的 AntBuilder 教程</a>以及<a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/ant.html">第 19 章</a>。</p>
<h3 id="14-11-使用方法"><a href="#14-11-使用方法" class="headerlink" title="14.11 使用方法"></a>14.11 使用方法</h3><p>在 Gradle 脚本里也可以声明方法并在其他任务中调用方法：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">task checksum &lt;&lt; &#123;</span><br><span class="line">    fileList(<span class="string">&#x27;../antLoadfileResources&#x27;</span>).each &#123;File file -&gt;</span><br><span class="line">        ant.checksum(<span class="attr">file:</span> file, <span class="attr">property:</span> <span class="string">&quot;cs_$file.name&quot;</span>)</span><br><span class="line">        println <span class="string">&quot;$file.name Checksum: $&#123;ant.properties[&quot;</span>cs_$file.name<span class="string">&quot;]&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task loadfile &lt;&lt; &#123;</span><br><span class="line">    fileList(<span class="string">&#x27;../antLoadfileResources&#x27;</span>).each &#123;File file -&gt;</span><br><span class="line">        ant.loadfile(<span class="attr">srcFile:</span> file, <span class="attr">property:</span> file.name)</span><br><span class="line">        println <span class="string">&quot;I&#x27;m fond of $file.name&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">File[] fileList(String dir) &#123;</span><br><span class="line">    file(dir).listFiles(&#123;file -&gt; file.isFile() &#125; <span class="keyword">as</span> FileFilter).sort()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-12-默认任务"><a href="#14-12-默认任务" class="headerlink" title="14.12 默认任务"></a>14.12 默认任务</h3><p>可以通过 <code>defaultTasks</code> 方法来指定默认任务：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaultTasks <span class="string">&#x27;clean&#x27;</span>, <span class="string">&#x27;run&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="14-13-基于-DAG-的配置"><a href="#14-13-基于-DAG-的配置" class="headerlink" title="14.13 基于 DAG 的配置"></a>14.13 基于 DAG 的配置</h3><p>在<a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/build_lifecycle.html">第 20 章</a>可以了解到，Gradle 执行时分为配置阶段和执行阶段，其中任务 DAG 的解析在配置阶段完成，而任务的实际执行则属于执行阶段。因此，部分任务也可以基于 DAG 的信息来改变自己的行为：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">task distribution &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">&quot;We build the zip with version=$version&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task release(<span class="attr">dependsOn:</span> <span class="string">&#x27;distribution&#x27;</span>) &lt;&lt; &#123;</span><br><span class="line">    println <span class="string">&#x27;We release now&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gradle.taskGraph.whenReady &#123;taskGraph -&gt;</span><br><span class="line">    <span class="keyword">if</span> (taskGraph.hasTask(release)) &#123;</span><br><span class="line">        version = <span class="string">&#x27;1.0&#x27;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        version = <span class="string">&#x27;1.0-SNAPSHOT&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="44-Java-项目构建入门"><a href="#44-Java-项目构建入门" class="headerlink" title="44 Java 项目构建入门"></a>44 Java 项目构建入门</h2><h3 id="44-1-Java-插件"><a href="#44-1-Java-插件" class="headerlink" title="44.1 Java 插件"></a>44.1 Java 插件</h3><p>比起 Maven 只能用于构建 JVM 项目，实际上 Gradle 是一个更加 general 的构建工具：在 Gradle 主页上我们也能看到 Gradle 甚至能用于构建 C++ 项目。Gradle 的强大来源于其使用 Groovy 脚本来定义构建逻辑，因此只要你写得出来，Gradle 就做得出来，但前提是你必须在构建脚本里写清楚 Gradle 该怎么做。</p>
<p>但对于同样类型的项目，比如同样是 Java 项目，每次创建一个新项目都要把编译、测试、打包等逻辑写到脚本里是很麻烦的，因此 Gradle 可以使用插件，其中就包括专门用于 Java 项目的 Java 插件。</p>
<p>插件通常通过引入一些预定义的任务来省去程序员编写脚本的功夫。比如说像编译、测试、打包这样十分常见的逻辑，在 Java 插件中就对应着 <code>compile</code>、<code>test</code>、<code>jar</code> 等预定义的任务。</p>
<p>Java 插件本身是基于惯例的，它会为项目默认指定一些配置，例如源代码文件和测试代码文件的位置等。如果项目没有遵循这些惯例也可以通过脚本来进行修改。实际上，由于 Gradle 的 Java 项目构建功能本身就是委托给 Java 插件的，如果实在有必要你甚至可以不使用 Java 插件以寻求最大的定制化。</p>
<h3 id="44-2-基本的-Java-项目"><a href="#44-2-基本的-Java-项目" class="headerlink" title="44.2 基本的 Java 项目"></a>44.2 基本的 Java 项目</h3><p>在构建文件中加入如下代码：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;java&#x27;</span></span><br></pre></td></tr></table></figure>

<p>如此一来，Gradle 就知道这是一个 Java 项目并应用 Java 插件了，你在构建时也就可以使用 Java 插件预定义的任务了。你可以使用 <kbd>gradle tasks</kbd> 来查看由 Java 插件添加的任务。</p>
<p>Java 插件对项目的结构做出如下默认配置：</p>
<ul>
<li>源代码文件位于 <code>src/main/java</code></li>
<li>测试代码文件位于 <code>src/test/java</code></li>
<li>所有位于 <code>src/main/resources</code> 的文件都会被作为资源文件复制到构建出的 JAR 文件中</li>
<li>所有位于 <code>src/test/resources</code> 的文件都会在运行测试时被添加到 classpath 中</li>
<li>所有的构建输出文件都会出现在 <code>build</code> 文件夹中，其中构建出的 JAR 文件会位于 <code>build/libs</code></li>
</ul>
<h4 id="44-2-1-构建项目"><a href="#44-2-1-构建项目" class="headerlink" title="44.2.1 构建项目"></a>44.2.1 构建项目</h4><p>主要提到可以用 <code>build</code> 任务来构建 Java 项目。</p>
<p>除此之外还提到如下几个有用的任务：</p>
<ul>
<li><code>clean</code>：删除 <code>build</code> 文件夹</li>
<li><code>assemble</code>：编译并将代码打包成 JAR 但不执行任何单元测试。其他插件可能会为该任务添加更多的行为，如使用 War 插件时该任务还会为任务构建 WAR 文件</li>
<li><code>check</code>：编译并测试代码。其他插件可能会为该任务添加更多的行为，如使用 <code>checkstyle</code> 插件时该任务还会对你的源代码执行代码风格检测</li>
</ul>
<h4 id="44-2-2-外部依赖"><a href="#44-2-2-外部依赖" class="headerlink" title="44.2.2 外部依赖"></a>44.2.2 外部依赖</h4><p>同第七章。</p>
<h4 id="44-2-3-项目自定义"><a href="#44-2-3-项目自定义" class="headerlink" title="44.2.3 项目自定义"></a>44.2.3 项目自定义</h4><p>正如前面所说，Java 插件实际上为项目引入了大量的属性并基于惯例为这些属性赋了默认值。通常来讲这些默认值都足够用于普通的 Java 项目，但你也可以在脚本中改变这些属性值以实现项目定制化。</p>
<p>如如下代码：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sourceCompatibility = <span class="number">1.7</span></span><br><span class="line">version = <span class="string">&#x27;1.0&#x27;</span></span><br><span class="line">jar &#123;</span><br><span class="line">    manifest &#123;</span><br><span class="line">        attributes <span class="string">&#x27;Implementation-Title&#x27;</span>: <span class="string">&#x27;Gradle Quickstart&#x27;</span>,</span><br><span class="line">                   <span class="string">&#x27;Implementation-Version&#x27;</span>: version</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你可以通过 <kbd>gradle properties</kbd> 来查看项目的所有属性。</p>
<p>除此之外，由 Java 插件预定义的任务和其他在构建脚本中定义的任务没什么不同，你也可以在脚本中访问这些任务并对它们做出设置。具体设置方式详见第 14 章。</p>
<h4 id="44-2-4-发布-JAR-文件"><a href="#44-2-4-发布-JAR-文件" class="headerlink" title="44.2.4 发布 JAR 文件"></a>44.2.4 发布 JAR 文件</h4><p>同 7.6 节。</p>
<h4 id="44-2-5-创建-Eclipse-项目"><a href="#44-2-5-创建-Eclipse-项目" class="headerlink" title="44.2.5 创建 Eclipse 项目"></a>44.2.5 创建 Eclipse 项目</h4><p>使用 <code>eclipse</code> 插件：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;eclipse&#x27;</span></span><br></pre></td></tr></table></figure>

<p>然后执行 <kbd>gradle eclipse</kbd> 命令即可生成 Eclipse 项目文件。详见<a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/eclipse_plugin.html">第 63 章</a>。</p>
<h3 id="44-3-多项目-Java-构建"><a href="#44-3-多项目-Java-构建" class="headerlink" title="44.3 多项目 Java 构建"></a>44.3 多项目 Java 构建</h3><h4 id="44-3-1-定义多项目构建"><a href="#44-3-1-定义多项目构建" class="headerlink" title="44.3.1 定义多项目构建"></a>44.3.1 定义多项目构建</h4><p>首先，多项目构建需要在根目录创建一个 <code>settings.gradle</code> 并指定包含的子项目：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include <span class="string">&quot;shared&quot;</span>, <span class="string">&quot;api&quot;</span>, <span class="string">&quot;services:webservice&quot;</span>, <span class="string">&quot;services:shared&quot;</span> </span><br></pre></td></tr></table></figure>

<p>详见<a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/multi_project_builds.html">第 24 章</a>。</p>
<h4 id="44-3-2-共用配置"><a href="#44-3-2-共用配置" class="headerlink" title="44.3.2 共用配置"></a>44.3.2 共用配置</h4><p>对于大多数的多项目构建而言，总有一些配置是各个子项目都相同的。这些配置可以被集中放在根项目的构建文件中，并使用名为“配置嵌入”的方式来将这些配置应用到每一个子项目。</p>
<p>见如下脚本配置：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">subprojects &#123;</span><br><span class="line">    apply <span class="attr">plugin:</span> <span class="string">&#x27;java&#x27;</span></span><br><span class="line">    apply <span class="attr">plugin:</span> <span class="string">&#x27;eclipse-wtp&#x27;</span></span><br><span class="line"></span><br><span class="line">    repositories &#123;</span><br><span class="line">       mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dependencies &#123;</span><br><span class="line">        testCompile <span class="string">&#x27;junit:junit:4.12&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    version = <span class="string">&#x27;1.0&#x27;</span></span><br><span class="line"></span><br><span class="line">    jar &#123;</span><br><span class="line">        manifest.attributes <span class="attr">provider:</span> <span class="string">&#x27;gradle&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码所使用到的 <code>subprojects</code> 方法会遍历项目中的每一个子项目并应用给定的闭包，如此一来便能将闭包内的配置应用到每一个子项目。</p>
<p>值得注意的是，Java 插件的应用语句被放置在了 <code>subprojects</code> 里面而不是外面，如此一来 Gradle 便不会把根项目当做是一个 Java 项目并到那些预定义的地方寻找源代码文件了。</p>
<h4 id="44-3-3-子项目间的依赖"><a href="#44-3-3-子项目间的依赖" class="headerlink" title="44.3.3 子项目间的依赖"></a>44.3.3 子项目间的依赖</h4><p>如下述代码所示：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile project(<span class="string">&#x27;:shared&#x27;</span>)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="16-编写构建脚本"><a href="#16-编写构建脚本" class="headerlink" title="16 编写构建脚本"></a>16 编写构建脚本</h2><h3 id="16-1-Gradle-构建语言"><a href="#16-1-Gradle-构建语言" class="headerlink" title="16.1 Gradle 构建语言"></a>16.1 Gradle 构建语言</h3><p>Gradle 在 Groovy 的基础上开发出了一套专门用于便捷地进行构建任务的 DSL，因此在 Gradle 构建脚本中我们可以任意地使用 Groovy 语言。除此之外，Gradle 默认假设我们使用 UTF-8 编写脚本。</p>
<h3 id="16-2-Project-API"><a href="#16-2-Project-API" class="headerlink" title="16.2 Project API"></a>16.2 <code>Project</code> API</h3><p>对于构建中的每个项目，Gradle 都会为它们各自生成一个 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/dsl/org.gradle.api.Project.html"><code>Project</code></a> 对象并将其与对应项目的构建脚本绑定起来，并在执行脚本时进行如下动作：</p>
<ul>
<li>凡是对任何没有在该构建脚本中定义的方法进行调用时，该调用都会被委托给对应的 <code>Project</code> 对象</li>
<li>凡是对任何没有在该构建脚本中定义的属性进行访问时，该访问都会被委托给对应的 <code>Project</code> 对象</li>
</ul>
<h3 id="16-3-Script-API"><a href="#16-3-Script-API" class="headerlink" title="16.3 Script API"></a>16.3 <code>Script</code> API</h3><p>Gradle 在执行脚本时实际上会把脚本内容放入到一个实现了 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/dsl/org.gradle.api.Script.html"><code>Script</code></a> 接口的类中进行编译，因此你可以在你的脚本中使用所有由 <code>Script</code> 声明的属性和方法。</p>
<h3 id="16-4-声明变量"><a href="#16-4-声明变量" class="headerlink" title="16.4 声明变量"></a>16.4 声明变量</h3><h4 id="16-4-1-本地变量"><a href="#16-4-1-本地变量" class="headerlink" title="16.4.1 本地变量"></a>16.4.1 本地变量</h4><p>同 Groovy，使用 <code>def</code> 关键字声明本地变量。本地变量只能在其所属的作用域内访问。</p>
<h4 id="16-4-2-额外属性"><a href="#16-4-2-额外属性" class="headerlink" title="16.4.2 额外属性"></a>16.4.2 额外属性</h4><p>我们可以通过部分由 Gradle 定义的类的 <code>ext</code> 属性为该对象添加更多的属性：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&quot;java&quot;</span></span><br><span class="line"></span><br><span class="line">ext &#123;</span><br><span class="line">    springVersion = <span class="string">&quot;3.1.0.RELEASE&quot;</span></span><br><span class="line">    emailNotification = <span class="string">&quot;build@master.org&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sourceSets.all &#123; ext.purpose = <span class="literal">null</span> &#125;</span><br><span class="line"></span><br><span class="line">sourceSets &#123;</span><br><span class="line">    main &#123;</span><br><span class="line">        purpose = <span class="string">&quot;production&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    test &#123;</span><br><span class="line">        purpose = <span class="string">&quot;test&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    plugin &#123;</span><br><span class="line">        purpose = <span class="string">&quot;production&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task printProperties &lt;&lt; &#123;</span><br><span class="line">    println springVersion</span><br><span class="line">    println emailNotification</span><br><span class="line">    sourceSets.matching &#123; it.purpose == <span class="string">&quot;production&quot;</span> &#125;.each &#123; println it.name &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; gradle -q printProperties</span><br><span class="line">3.1.0.RELEASE</span><br><span class="line">build@master.org</span><br><span class="line">main</span><br><span class="line">plugin</span><br></pre></td></tr></table></figure>

<p>有关额外属性以及其 API 的更多内容详见 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/dsl/org.gradle.api.plugins.ExtraPropertiesExtension.html"><code>ExtraPropertiesExtension</code></a> 类的文档。</p>
<h3 id="16-5-配置任意对象"><a href="#16-5-配置任意对象" class="headerlink" title="16.5 配置任意对象"></a>16.5 配置任意对象</h3><p>可以使用 <code>configure</code> 方法来配置任意对象：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> pos = configure(<span class="keyword">new</span> java.text.FieldPosition(<span class="number">10</span>)) &#123;</span><br><span class="line">    beginIndex = <span class="number">1</span></span><br><span class="line">    endIndex = <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line">println pos.beginIndex</span><br><span class="line">println pos.endIndex</span><br></pre></td></tr></table></figure>

<h3 id="16-6-使用其他脚本配置对象"><a href="#16-6-使用其他脚本配置对象" class="headerlink" title="16.6 使用其他脚本配置对象"></a>16.6 使用其他脚本配置对象</h3><p>对对象的配置甚至还能放入到另一个 <code>.gradle</code> 文件中。</p>
<p>我们可以在 <code>other.gradle</code> 中输入：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Set properties.</span></span><br><span class="line">beginIndex = <span class="number">1</span></span><br><span class="line">endIndex = <span class="number">5</span>   </span><br></pre></td></tr></table></figure>

<p>如下代码即可完成与上一节相同的配置：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> pos = <span class="keyword">new</span> java.text.FieldPosition(<span class="number">10</span>)</span><br><span class="line"><span class="comment">// Apply the script</span></span><br><span class="line">apply <span class="attr">from:</span> <span class="string">&#x27;other.gradle&#x27;</span>, <span class="attr">to:</span> pos</span><br><span class="line">println pos.beginIndex</span><br><span class="line">println pos.endIndex</span><br></pre></td></tr></table></figure>

<h3 id="16-7-Groovy-基础"><a href="#16-7-Groovy-基础" class="headerlink" title="16.7 Groovy 基础"></a>16.7 Groovy 基础</h3><p>介绍了 Groovy 的一些基本语法特性。可以去看我之前写过的 Groovy 相关的博文。</p>
<h3 id="16-8-默认引入"><a href="#16-8-默认引入" class="headerlink" title="16.8 默认引入"></a>16.8 默认引入</h3><p>Gradle 脚本本身也会默认引入 Gradle 的包。引入数量较多，详见 <a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/writing_build_scripts.html#script-default-imports">16.8 小节</a>。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Gradle 学习笔记</p><p><a href="https://mr-dai.github.io/gradle-note/">https://mr-dai.github.io/gradle-note/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Robert Peng</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2018-04-24</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2018-04-24</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Gradle/">Gradle</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/alipay-qrcode.png" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechat-qrcode.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/groovy-integrating/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Groovy 教程 - 整合 Groovy 至应用程序</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/groovy-dev-kit/"><span class="level-item">Groovy 教程 - GDK</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://mr-dai.github.io/gradle-note/';
            this.page.identifier = 'gradle-note/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'robertpsblog' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="呆呆"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">呆呆</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国广州</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">49</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">9</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">35</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://www.zhihu.com/people/robert.peng" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="知乎" href="https://www.zhihu.com/people/robert.peng"><i class="fab fa-zhihu"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Mr-Dai"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Bash/"><span class="tag">Bash</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bigtable/"><span class="tag">Bigtable</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GC/"><span class="tag">GC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go/"><span class="tag">Go</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Gradle/"><span class="tag">Gradle</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Groovy/"><span class="tag">Groovy</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HBase/"><span class="tag">HBase</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hadoop/"><span class="tag">Hadoop</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hive-ThriftServer/"><span class="tag">Hive ThriftServer</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JVM/"><span class="tag">JVM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MIT-6-824/"><span class="tag">MIT 6.824</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mesos/"><span class="tag">Mesos</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Paxos/"><span class="tag">Paxos</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raft/"><span class="tag">Raft</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SQL/"><span class="tag">SQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spark/"><span class="tag">Spark</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spark-SQL/"><span class="tag">Spark SQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SparkSQL/"><span class="tag">SparkSQL</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows/"><span class="tag">Windows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Yarn/"><span class="tag">Yarn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ZooKeeper/"><span class="tag">ZooKeeper</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/etcd/"><span class="tag">etcd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%87%E4%BB%BD/"><span class="tag">主从备份</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%85%B1%E8%AF%86/"><span class="tag">分布式共识</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%86%85%E5%AD%98/"><span class="tag">分布式内存</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/"><span class="tag">分布式存储</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/"><span class="tag">分布式系统</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97/"><span class="tag">分布式计算</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C/"><span class="tag">团队协作</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/"><span class="tag">集群资源调度</span><span class="tag">2</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#4-使用-Gradle-命令行"><span class="level-left"><span class="level-item">1</span><span class="level-item">4 使用 Gradle 命令行</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#4-1-执行多个任务"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">4.1 执行多个任务</span></span></a></li><li><a class="level is-mobile" href="#4-2-排除任务"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">4.2 排除任务</span></span></a></li><li><a class="level is-mobile" href="#4-3-在任务失败后继续构建"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">4.3 在任务失败后继续构建</span></span></a></li><li><a class="level is-mobile" href="#4-4-任务名称缩写"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">4.4 任务名称缩写</span></span></a></li><li><a class="level is-mobile" href="#4-5-选择要执行的构建"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">4.5 选择要执行的构建</span></span></a></li><li><a class="level is-mobile" href="#4-6-强制任务执行"><span class="level-left"><span class="level-item">1.6</span><span class="level-item">4.6 强制任务执行</span></span></a></li><li><a class="level is-mobile" href="#4-7-获取构建的相关信息"><span class="level-left"><span class="level-item">1.7</span><span class="level-item">4.7 获取构建的相关信息</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#4-7-1-显示所有项目"><span class="level-left"><span class="level-item">1.7.1</span><span class="level-item">4.7.1 显示所有项目</span></span></a></li><li><a class="level is-mobile" href="#4-7-2-显示所有任务"><span class="level-left"><span class="level-item">1.7.2</span><span class="level-item">4.7.2 显示所有任务</span></span></a></li><li><a class="level is-mobile" href="#4-7-3-查看任务的具体使用方法"><span class="level-left"><span class="level-item">1.7.3</span><span class="level-item">4.7.3 查看任务的具体使用方法</span></span></a></li><li><a class="level is-mobile" href="#4-7-4-显示任务的依赖"><span class="level-left"><span class="level-item">1.7.4</span><span class="level-item">4.7.4 显示任务的依赖</span></span></a></li><li><a class="level is-mobile" href="#4-7-5-显示项目的构建脚本依赖"><span class="level-left"><span class="level-item">1.7.5</span><span class="level-item">4.7.5 显示项目的构建脚本依赖</span></span></a></li><li><a class="level is-mobile" href="#4-7-6-查看具体依赖的详细信息"><span class="level-left"><span class="level-item">1.7.6</span><span class="level-item">4.7.6 查看具体依赖的详细信息</span></span></a></li><li><a class="level is-mobile" href="#4-7-7-显示所有项目属性"><span class="level-left"><span class="level-item">1.7.7</span><span class="level-item">4.7.7 显示所有项目属性</span></span></a></li><li><a class="level is-mobile" href="#4-7-8-构建报告"><span class="level-left"><span class="level-item">1.7.8</span><span class="level-item">4.7.8 构建报告</span></span></a></li></ul></li><li><a class="level is-mobile" href="#4-8-构建预演"><span class="level-left"><span class="level-item">1.8</span><span class="level-item">4.8 构建预演</span></span></a></li><li><a class="level is-mobile" href="#4-9-总结"><span class="level-left"><span class="level-item">1.9</span><span class="level-item">4.9 总结</span></span></a></li></ul></li><li><a class="level is-mobile" href="#5-Gradle-Wrapper"><span class="level-left"><span class="level-item">2</span><span class="level-item">5 Gradle Wrapper</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#5-1-使用-Gradle-Wrapper-执行构建"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">5.1 使用 Gradle Wrapper 执行构建</span></span></a></li><li><a class="level is-mobile" href="#5-2-为项目安装-Wrapper"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">5.2 为项目安装 Wrapper</span></span></a></li></ul></li><li><a class="level is-mobile" href="#6-Gradle-守护线程"><span class="level-left"><span class="level-item">3</span><span class="level-item">6 Gradle 守护线程</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#6-1-为何要使用-Gradle-守护线程"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">6.1 为何要使用 Gradle 守护线程</span></span></a></li><li><a class="level is-mobile" href="#6-2-检查守护线程的状态"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">6.2 检查守护线程的状态</span></span></a></li><li><a class="level is-mobile" href="#6-3-关闭守护线程功能"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">6.3 关闭守护线程功能</span></span></a></li><li><a class="level is-mobile" href="#6-4-关闭正在运行的守护线程"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">6.4 关闭正在运行的守护线程</span></span></a></li><li><a class="level is-mobile" href="#6-6-何时不该使用-Gradle-守护线程"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">6.6 何时不该使用 Gradle 守护线程</span></span></a></li></ul></li><li><a class="level is-mobile" href="#7-依赖管理入门"><span class="level-left"><span class="level-item">4</span><span class="level-item">7 依赖管理入门</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#7-2-声明依赖"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">7.2 声明依赖</span></span></a></li><li><a class="level is-mobile" href="#7-3-依赖配置"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">7.3 依赖配置</span></span></a></li><li><a class="level is-mobile" href="#7-4-外部依赖"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">7.4 外部依赖</span></span></a></li><li><a class="level is-mobile" href="#7-5-库"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">7.5 库</span></span></a></li><li><a class="level is-mobile" href="#7-6-发布程序包"><span class="level-left"><span class="level-item">4.5</span><span class="level-item">7.6 发布程序包</span></span></a></li></ul></li><li><a class="level is-mobile" href="#8-多项目构建"><span class="level-left"><span class="level-item">5</span><span class="level-item">8 多项目构建</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#8-1-多项目构建的基本结构"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">8.1 多项目构建的基本结构</span></span></a></li><li><a class="level is-mobile" href="#8-2-执行多项目构建"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">8.2 执行多项目构建</span></span></a></li></ul></li><li><a class="level is-mobile" href="#9-持续构建"><span class="level-left"><span class="level-item">6</span><span class="level-item">9 持续构建</span></span></a></li><li><a class="level is-mobile" href="#10-使用-Gradle-图形界面"><span class="level-left"><span class="level-item">7</span><span class="level-item">10 使用 Gradle 图形界面</span></span></a></li><li><a class="level is-mobile" href="#15-构建初始化插件"><span class="level-left"><span class="level-item">8</span><span class="level-item">15 构建初始化插件</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#15-1-所执行的任务"><span class="level-left"><span class="level-item">8.1</span><span class="level-item">15.1 所执行的任务</span></span></a></li><li><a class="level is-mobile" href="#15-2-初始化类型"><span class="level-left"><span class="level-item">8.2</span><span class="level-item">15.2 初始化类型</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#15-3-1-pom"><span class="level-left"><span class="level-item">8.2.1</span><span class="level-item">15.3.1 pom</span></span></a></li><li><a class="level is-mobile" href="#15-3-2-java-library"><span class="level-left"><span class="level-item">8.2.2</span><span class="level-item">15.3.2 java-library</span></span></a></li><li><a class="level is-mobile" href="#15-3-3-scala-library"><span class="level-left"><span class="level-item">8.2.3</span><span class="level-item">15.3.3 scala-library</span></span></a></li><li><a class="level is-mobile" href="#15-3-4-groovy-library"><span class="level-left"><span class="level-item">8.2.4</span><span class="level-item">15.3.4 groovy-library</span></span></a></li><li><a class="level is-mobile" href="#15-3-5-basic"><span class="level-left"><span class="level-item">8.2.5</span><span class="level-item">15.3.5 basic</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#14-构建脚本入门"><span class="level-left"><span class="level-item">9</span><span class="level-item">14 构建脚本入门</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#14-1-项目和任务"><span class="level-left"><span class="level-item">9.1</span><span class="level-item">14.1 项目和任务</span></span></a></li><li><a class="level is-mobile" href="#14-2-Hello-World"><span class="level-left"><span class="level-item">9.2</span><span class="level-item">14.2 Hello World</span></span></a></li><li><a class="level is-mobile" href="#14-4-构建脚本就是代码"><span class="level-left"><span class="level-item">9.3</span><span class="level-item">14.4 构建脚本就是代码</span></span></a></li><li><a class="level is-mobile" href="#14-5-任务依赖"><span class="level-left"><span class="level-item">9.4</span><span class="level-item">14.5 任务依赖</span></span></a></li><li><a class="level is-mobile" href="#14-6-动态任务"><span class="level-left"><span class="level-item">9.5</span><span class="level-item">14.6 动态任务</span></span></a></li><li><a class="level is-mobile" href="#14-9-额外属性"><span class="level-left"><span class="level-item">9.6</span><span class="level-item">14.9 额外属性</span></span></a></li><li><a class="level is-mobile" href="#14-10-使用-Ant-任务"><span class="level-left"><span class="level-item">9.7</span><span class="level-item">14.10 使用 Ant 任务</span></span></a></li><li><a class="level is-mobile" href="#14-11-使用方法"><span class="level-left"><span class="level-item">9.8</span><span class="level-item">14.11 使用方法</span></span></a></li><li><a class="level is-mobile" href="#14-12-默认任务"><span class="level-left"><span class="level-item">9.9</span><span class="level-item">14.12 默认任务</span></span></a></li><li><a class="level is-mobile" href="#14-13-基于-DAG-的配置"><span class="level-left"><span class="level-item">9.10</span><span class="level-item">14.13 基于 DAG 的配置</span></span></a></li></ul></li><li><a class="level is-mobile" href="#44-Java-项目构建入门"><span class="level-left"><span class="level-item">10</span><span class="level-item">44 Java 项目构建入门</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#44-1-Java-插件"><span class="level-left"><span class="level-item">10.1</span><span class="level-item">44.1 Java 插件</span></span></a></li><li><a class="level is-mobile" href="#44-2-基本的-Java-项目"><span class="level-left"><span class="level-item">10.2</span><span class="level-item">44.2 基本的 Java 项目</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#44-2-1-构建项目"><span class="level-left"><span class="level-item">10.2.1</span><span class="level-item">44.2.1 构建项目</span></span></a></li><li><a class="level is-mobile" href="#44-2-2-外部依赖"><span class="level-left"><span class="level-item">10.2.2</span><span class="level-item">44.2.2 外部依赖</span></span></a></li><li><a class="level is-mobile" href="#44-2-3-项目自定义"><span class="level-left"><span class="level-item">10.2.3</span><span class="level-item">44.2.3 项目自定义</span></span></a></li><li><a class="level is-mobile" href="#44-2-4-发布-JAR-文件"><span class="level-left"><span class="level-item">10.2.4</span><span class="level-item">44.2.4 发布 JAR 文件</span></span></a></li><li><a class="level is-mobile" href="#44-2-5-创建-Eclipse-项目"><span class="level-left"><span class="level-item">10.2.5</span><span class="level-item">44.2.5 创建 Eclipse 项目</span></span></a></li></ul></li><li><a class="level is-mobile" href="#44-3-多项目-Java-构建"><span class="level-left"><span class="level-item">10.3</span><span class="level-item">44.3 多项目 Java 构建</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#44-3-1-定义多项目构建"><span class="level-left"><span class="level-item">10.3.1</span><span class="level-item">44.3.1 定义多项目构建</span></span></a></li><li><a class="level is-mobile" href="#44-3-2-共用配置"><span class="level-left"><span class="level-item">10.3.2</span><span class="level-item">44.3.2 共用配置</span></span></a></li><li><a class="level is-mobile" href="#44-3-3-子项目间的依赖"><span class="level-left"><span class="level-item">10.3.3</span><span class="level-item">44.3.3 子项目间的依赖</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#16-编写构建脚本"><span class="level-left"><span class="level-item">11</span><span class="level-item">16 编写构建脚本</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#16-1-Gradle-构建语言"><span class="level-left"><span class="level-item">11.1</span><span class="level-item">16.1 Gradle 构建语言</span></span></a></li><li><a class="level is-mobile" href="#16-2-Project-API"><span class="level-left"><span class="level-item">11.2</span><span class="level-item">16.2 Project API</span></span></a></li><li><a class="level is-mobile" href="#16-3-Script-API"><span class="level-left"><span class="level-item">11.3</span><span class="level-item">16.3 Script API</span></span></a></li><li><a class="level is-mobile" href="#16-4-声明变量"><span class="level-left"><span class="level-item">11.4</span><span class="level-item">16.4 声明变量</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#16-4-1-本地变量"><span class="level-left"><span class="level-item">11.4.1</span><span class="level-item">16.4.1 本地变量</span></span></a></li><li><a class="level is-mobile" href="#16-4-2-额外属性"><span class="level-left"><span class="level-item">11.4.2</span><span class="level-item">16.4.2 额外属性</span></span></a></li></ul></li><li><a class="level is-mobile" href="#16-5-配置任意对象"><span class="level-left"><span class="level-item">11.5</span><span class="level-item">16.5 配置任意对象</span></span></a></li><li><a class="level is-mobile" href="#16-6-使用其他脚本配置对象"><span class="level-left"><span class="level-item">11.6</span><span class="level-item">16.6 使用其他脚本配置对象</span></span></a></li><li><a class="level is-mobile" href="#16-7-Groovy-基础"><span class="level-left"><span class="level-item">11.7</span><span class="level-item">16.7 Groovy 基础</span></span></a></li><li><a class="level is-mobile" href="#16-8-默认引入"><span class="level-left"><span class="level-item">11.8</span><span class="level-item">16.8 默认引入</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/avatar.png" alt="Robert Peng&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2021 Robert Peng</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="我的 Github" href="https://github.com/Mr-Dai"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>