<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Embedding Python in Java using Jython - Robert Peng&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="呆呆的博客"><meta name="msapplication-TileImage" content="/img/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="呆呆的博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="In the past few days, I managed to find a way to dynamically load and run Python code in a Java program. In this post, I will briefly explain how I achieve this."><meta property="og:type" content="blog"><meta property="og:title" content="Embedding Python in Java using Jython"><meta property="og:url" content="https://mr-dai.github.io/embedding-jython/"><meta property="og:site_name" content="Robert Peng&#039;s Blog"><meta property="og:description" content="In the past few days, I managed to find a way to dynamically load and run Python code in a Java program. In this post, I will briefly explain how I achieve this."><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://mr-dai.github.io/img/og_image.png"><meta property="article:published_time" content="2018-09-10T16:00:00.000Z"><meta property="article:modified_time" content="2018-09-10T16:00:00.000Z"><meta property="article:author" content="Robert Peng"><meta property="article:tag" content="Java"><meta property="article:tag" content="Python"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://mr-dai.github.io/embedding-jython/"},"headline":"Embedding Python in Java using Jython","image":["https://mr-dai.github.io/img/og_image.png"],"datePublished":"2018-09-10T16:00:00.000Z","dateModified":"2018-09-10T16:00:00.000Z","author":{"@type":"Person","name":"Robert Peng"},"publisher":{"@type":"Organization","name":"Robert Peng's Blog","logo":{"@type":"ImageObject","url":"https://mr-dai.github.io/img/avatar.png"}},"description":"In the past few days, I managed to find a way to dynamically load and run Python code in a Java program. In this post, I will briefly explain how I achieve this."}</script><link rel="canonical" href="https://mr-dai.github.io/embedding-jython/"><link rel="icon" href="/img/avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/avatar.png" alt="Robert Peng&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="我的 Github" href="https://github.com/Mr-Dai"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-09-10T16:00:00.000Z" title="9/10/2018, 4:00:00 PM">2018-09-11</time>发表</span><span class="level-item"><time dateTime="2018-09-10T16:00:00.000Z" title="9/10/2018, 4:00:00 PM">2018-09-11</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Java/">Java</a></span></div></div><h1 class="title is-3 is-size-4-mobile">Embedding Python in Java using Jython</h1><div class="content"><p>In the past few days, I managed to find a way to dynamically load and run Python code in a Java program. In this post, I will briefly explain how I achieve this.</p>
<span id="more"></span>

<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Recently, I needed to add a new feature to the project I’ve been working on: it needs to be able to dynamically load Python code into a Spark Streaming program and use it to process real-time messages. In addition, this module need to support hot-reload: the program should be able to switch to a new Python code configuration without restarting the whole Spark Streaming job.</p>
<p>It is not unusual to use dynamic language in the Java plaform: <a target="_blank" rel="noopener" href="http://groovy-lang.org/">the Groovy language</a> was actually born for this, to some extent. Unfortunately, Groovy is not widly used among data developers, and Python would be a better choice in comparison.</p>
<p>Using Python in JVM-based computing framework is not uncommon either:</p>
<ul>
<li>Hadoop MapReduce can invoke ANY executable (not only Python) using <a target="_blank" rel="noopener" href="http://hadoop.apache.org/docs/current/hadoop-streaming/HadoopStreaming.html">Hadoop Streaming</a>; it uses stdin/stdout to transmit data between JVM and the designated program, which can be written in any language.</li>
<li>Apache Spark provides <a target="_blank" rel="noopener" href="https://spark.apache.org/docs/latest/api/python/index.html"><code>pyspark</code></a> using <a target="_blank" rel="noopener" href="https://www.py4j.org/">Py4J</a>, which enables efficient communication between JVM and Python program.</li>
<li><a target="_blank" rel="noopener" href="https://ci.apache.org/projects/flink/flink-docs-stable/dev/stream/python.html#jython-framework">Apache Flink uses Jython</a> to run user Python code.</li>
</ul>
<p>In the end, We chose Jython to achieve the highest performance possible. Jython is similar to Groovy, running in the same JVM process as the host Java program, in comparison to Hadoop Streaming or Py4J. But there are still a few things need to be considered when using Jython:</p>
<ul>
<li>Some PyPI packages might not be able to run in Jython, especially those with C extensions.</li>
<li>Using Jython without cautions might lead to memory leak, <a target="_blank" rel="noopener" href="https://dzone.com/articles/groovyshell-and-memory-leaks">like Groovy</a>.</li>
</ul>
<p>For now, Jython has released its 2.7.1 version in June, 2017, and supports up to Python 2.7 syntax. Although it hasn’t been updated for a very long time, Jython is actually still under active development, if you could take a look at its <a target="_blank" rel="noopener" href="http://hg.python.org/jython">source code repository</a>.</p>
<h2 id="Using-Jython"><a href="#Using-Jython" class="headerlink" title="Using Jython"></a>Using Jython</h2><p>The <a target="_blank" rel="noopener" href="http://www.jython.org/jythonbook/en/1.0/">Jython Book</a> has given a detailed explaination on how to use Jython, so I would not repeat it here. This post will mainly focus on how to use Jython in Java.</p>
<p>Actually, the <a target="_blank" rel="noopener" href="http://www.jython.org/archive/21/docs/embedding.html">official documentations</a> has already mentioned how to embed Jython in Java, and it’s pretty simple:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.python.util.PythonInterpreter; </span><br><span class="line"><span class="keyword">import</span> org.python.core.*; </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleEmbedded</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> PyException </span>&#123; </span><br><span class="line">        PythonInterpreter interp = <span class="keyword">new</span> PythonInterpreter();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Hello, brave new world&quot;</span>);</span><br><span class="line">        interp.exec(<span class="string">&quot;import sys&quot;</span>);</span><br><span class="line">        interp.exec(<span class="string">&quot;print sys&quot;</span>);</span><br><span class="line"></span><br><span class="line">        interp.set(<span class="string">&quot;a&quot;</span>, <span class="keyword">new</span> PyInteger(<span class="number">42</span>));</span><br><span class="line">        interp.exec(<span class="string">&quot;print a&quot;</span>);</span><br><span class="line">        interp.exec(<span class="string">&quot;x = 2+2&quot;</span>);</span><br><span class="line">        PyObject x = interp.get(<span class="string">&quot;x&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;x: &quot;</span>+x);</span><br><span class="line">        System.out.println(<span class="string">&quot;Goodbye, cruel world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Simple, but not practical:</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.jython.org/javadoc/org/python/util/PythonInterpreter.html"><code>PythonInterpreter</code></a> is a super heavy class: it maintains all the context and resources needed to compile and run Python code. You do not want to create too many instances of it.</li>
<li>Possibly related to how Jython is implemented, repeated invocations of <a target="_blank" rel="noopener" href="http://www.jython.org/javadoc/org/python/util/PythonInterpreter.html#eval(java.lang.String)"><code>PythonInterpreter.eval</code></a> will compile the same Python code over and over again, which can lead to memory leak.</li>
</ul>
<p>To solve these problems, the key is to reuse <code>PythonInterpreter</code> object, and try the best to avoid invoking <code>PythonInterpreter.eval</code>.</p>
<p>Reusing <code>PythonIntrepreter</code> is simple: just hold it somewhere in your program as a singleton. You can implement this singleton pattern in any way you like: Spring Application Context, double-check locking, you name it. We will just make it a <code>private static final</code> variable here:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PythonRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> PythonInterpreter intr = <span class="keyword">new</span> PythonInterpreter();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PythonRunner</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It’s a bit trickier to avoid invoking <code>PythonInterpreter.eval</code>, as it is the only method we can use to run designated Python code and get its result.</p>
<p>Groovy provides <a target="_blank" rel="noopener" href="http://docs.groovy-lang.org/latest/html/api/groovy/lang/GroovyShell.html#parse-java.lang.String-"><code>GroovyShell.parse</code></a>, which takes a Groovy script as input and returns a <a target="_blank" rel="noopener" href="http://docs.groovy-lang.org/latest/html/api/groovy/lang/Script.html"><code>Script</code></a> instance. Groovy here actually wrap the given script in a newly created Java class (which extends <code>Script</code>), and so we can use this class to create new <code>Script</code> instances, and reuse the same compiled Groovy code.</p>
<p>We can implement the same technique in Jython – actually the Jython Book has also mentioned this kind of usage, which named <a target="_blank" rel="noopener" href="http://www.jython.org/jythonbook/en/1.0/JythonAndJavaIntegration.html#object-factories">Object Factory</a>.</p>
<p>You can choose to compile your Python code in a Python class, but we will just use it as a Python function here, which suffices in our scenario:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.python.core.PyFunction;</span><br><span class="line"><span class="keyword">import</span> org.python.util.PythonInterpreter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PythonRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> PythonInterpreter intr = <span class="keyword">new</span> PythonInterpreter();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FUNC_TPL = String.join(<span class="string">&quot;\n&quot;</span>, <span class="keyword">new</span> String[]&#123;</span><br><span class="line">        <span class="string">&quot;def __call__():&quot;</span>,</span><br><span class="line">        <span class="string">&quot;    %s&quot;</span>,</span><br><span class="line">        <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PyFunction func;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PythonRunner</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Render the function body</span></span><br><span class="line">        String[] lines = code.split(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; lines.length; i++)</span><br><span class="line">            lines[i] = <span class="string">&quot;    &quot;</span> + lines[i];</span><br><span class="line">        code = String.join(<span class="string">&quot;\n&quot;</span>, lines);</span><br><span class="line">        code = String.format(FUNC_TPL, code);</span><br><span class="line">        </span><br><span class="line">        intr.exec(code);</span><br><span class="line">        func = (PyFunction) intr.get(funcName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> func.__call__();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that you need to use <a target="_blank" rel="noopener" href="http://www.jython.org/javadoc/org/python/util/PythonInterpreter.html#exec(java.lang.String)"><code>PythonInterpreter.exec</code></a> to compile the Python function here, and <a target="_blank" rel="noopener" href="http://www.jython.org/javadoc/org/python/util/PythonInterpreter.html#get(java.lang.String)"><code>get</code></a> the Python function object later.</p>
<p>So far, you have learned how to load and run Python code safely in a Java program. You can easily extend this code to meet your own requirement.</p>
<p>Next I will introduce you some other extensions I made to make it more useful.</p>
<h2 id="Using-Java-Object-in-Jython"><a href="#Using-Java-Object-in-Jython" class="headerlink" title="Using Java Object in Jython"></a>Using Java Object in Jython</h2><p>When you are using the <code>PyFunction</code> object, you may notice that its <a target="_blank" rel="noopener" href="http://www.jython.org/javadoc/org/python/core/PyFunction.html#__call__(org.python.core.PyObject)"><code>__call__</code></a> method accepts <code>PyObject</code> as parameter. Does that mean we need to convert our Java object to <code>PyObject</code> so that our Python code can use it?</p>
<p>The answer is no, Jython has already implemented such function. If what you provide is a “standard” Java object, Jython will “mock” it into the corresponding Python primitive types:</p>
<ul>
<li>All Java primitive types can used as the corresponding Python primitive types</li>
<li><code>java.util.Map</code> instances can be used as normal Python <code>dict</code></li>
<li><code>java.util.List</code> instances can be used as normal Python <code>list</code></li>
</ul>
<p>Take my code as an example, we use <a target="_blank" rel="noopener" href="https://github.com/alibaba/fastjson/blob/master/src/main/java/com/alibaba/fastjson/JSONObject.java"><code>JSONObject</code></a> from <a target="_blank" rel="noopener" href="https://github.com/alibaba/fastjson">FastJSON</a> in our project, which implements <code>java.util.Map</code>, so in my Python code, I can access its members in the way I would do to a normal Python <code>dict</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">json</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> json[<span class="string">&#x27;test&#x27;</span>]:</span><br><span class="line">        json[<span class="string">&#x27;test&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>DO note that Jython won’t change the type of your object: if you try to do <code>instanceof</code> comparison in your Python code, it would return <code>False</code>; if you do <code>is False</code> or <code>is True</code> to a Java <code>bool</code> value, it would return <code>False</code>. Jython just mimic the behavior of standard Python entities for these Java objects (duck typing), but essentially they are not the same type.</p>
<h2 id="Importing-PIP-Packages"><a href="#Importing-PIP-Packages" class="headerlink" title="Importing PIP Packages"></a>Importing PIP Packages</h2><p>To further reduce the amount of Python code we need to write, we might want to maintain some common Python code in a package and reuse it by <code>import</code>ing it. Jython also supports importing external Python source file, but first we will need to set the <code>sys.path</code> accordingly.</p>
<p>By default, Jython (or Python) will automatically include the current working directory in the <code>sys.path</code>, so if we want to use some self-made Python file, we can just add it to the current working directory and <code>import</code> it. But if we want to use those packages installed by PIP, we will need some extra configuration.</p>
<p>The key is to add the local PIP install directory to the <code>sys.path</code> of Jython. You can do this in many ways, but the safest solution is to just ask the local Python interpreter:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PythonRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> PythonInterpreter intr = <span class="keyword">new</span> PythonInterpreter();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        intr.exec(<span class="string">&quot;import sys&quot;</span>);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Process p = Runtime.getRuntime().exec(<span class="keyword">new</span> String[]&#123;</span><br><span class="line">                <span class="string">&quot;python2&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;import json; import sys; print json.dumps(sys.path)&quot;</span>&#125;);</span><br><span class="line">            p.waitFor();</span><br><span class="line">            </span><br><span class="line">            String stdout = IOUtils.toString(p.getInputStream());</span><br><span class="line">            JSONArray syspathRaw = JSONArray.parseArray(stdout);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; syspathRaw.size(); i++) &#123;</span><br><span class="line">                String path = syspathRaw.getString(i);</span><br><span class="line">                <span class="keyword">if</span> (path.contains(<span class="string">&quot;site-packages&quot;</span>) || path.contains(<span class="string">&quot;dist-packages&quot;</span>))</span><br><span class="line">                    inter.exec(String.format(<span class="string">&quot;sys.path.insert(0, &#x27;%s&#x27;)&quot;</span>, path));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As I mentioned earlier at the beginning of this post, not all PyPI packages can run in Jython, especially those contain C code. Try to <code>import</code> the package you want to use in Jython shell and test its fuctions before going further.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This post is mainly an epilogue to the work I’ve been doing in the past few days.</p>
<p>I would not consider Jython as an 100% safe solution: the truth is, you may run into some very subtle bug when you use it, and its API and documentations is nothing close to “friendly”. But if you want to achieve something like mine, Jython definitely worth a look.</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Embedding Python in Java using Jython</p><p><a href="https://mr-dai.github.io/embedding-jython/">https://mr-dai.github.io/embedding-jython/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>Robert Peng</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2018-09-11</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2018-09-11</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Java/">Java</a><a class="link-muted mr-2" rel="tag" href="/tags/Python/">Python</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/alipay-qrcode.png" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechat-qrcode.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/zookeeper/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">ZooKeeper —— 分布式系统协调服务</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/spinnaker/"><span class="level-item">Spinnaker —— 使用 Paxos 构建分布式 KV 数据库</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://mr-dai.github.io/embedding-jython/';
            this.page.identifier = 'embedding-jython/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'robertpsblog' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="呆呆"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">呆呆</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国广州</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">49</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">9</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">35</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://www.zhihu.com/people/robert.peng" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="知乎" href="https://www.zhihu.com/people/robert.peng"><i class="fab fa-zhihu"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Mr-Dai"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Bash/"><span class="tag">Bash</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bigtable/"><span class="tag">Bigtable</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GC/"><span class="tag">GC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go/"><span class="tag">Go</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Gradle/"><span class="tag">Gradle</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Groovy/"><span class="tag">Groovy</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HBase/"><span class="tag">HBase</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hadoop/"><span class="tag">Hadoop</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hive-ThriftServer/"><span class="tag">Hive ThriftServer</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JVM/"><span class="tag">JVM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MIT-6-824/"><span class="tag">MIT 6.824</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mesos/"><span class="tag">Mesos</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Paxos/"><span class="tag">Paxos</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raft/"><span class="tag">Raft</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SQL/"><span class="tag">SQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spark/"><span class="tag">Spark</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spark-SQL/"><span class="tag">Spark SQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SparkSQL/"><span class="tag">SparkSQL</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows/"><span class="tag">Windows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Yarn/"><span class="tag">Yarn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ZooKeeper/"><span class="tag">ZooKeeper</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/etcd/"><span class="tag">etcd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%87%E4%BB%BD/"><span class="tag">主从备份</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%85%B1%E8%AF%86/"><span class="tag">分布式共识</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%86%85%E5%AD%98/"><span class="tag">分布式内存</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/"><span class="tag">分布式存储</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/"><span class="tag">分布式系统</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97/"><span class="tag">分布式计算</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C/"><span class="tag">团队协作</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/"><span class="tag">集群资源调度</span><span class="tag">2</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Background"><span class="level-left"><span class="level-item">1</span><span class="level-item">Background</span></span></a></li><li><a class="level is-mobile" href="#Using-Jython"><span class="level-left"><span class="level-item">2</span><span class="level-item">Using Jython</span></span></a></li><li><a class="level is-mobile" href="#Using-Java-Object-in-Jython"><span class="level-left"><span class="level-item">3</span><span class="level-item">Using Java Object in Jython</span></span></a></li><li><a class="level is-mobile" href="#Importing-PIP-Packages"><span class="level-left"><span class="level-item">4</span><span class="level-item">Importing PIP Packages</span></span></a></li><li><a class="level is-mobile" href="#Conclusion"><span class="level-left"><span class="level-item">5</span><span class="level-item">Conclusion</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/avatar.png" alt="Robert Peng&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2021 Robert Peng</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="我的 Github" href="https://github.com/Mr-Dai"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>